#include "Arduino.h"

#define MQ9_PIN 34                    
#define VOLTAGE_REF 3.3               
#define ADC_RESOLUTION 4095.0         
#define PPM_THRESHOLD 100  

#define SMOKE_SENSOR_PIN 32    
#define SAFETY_LIMIT 1400  // Assumed Value     

#define LPG_SENSOR 33  

#define BUZZER_PIN 25     

void setup() {
    Serial.begin(115200); 
    delay(5000);                    // Allow sensor to stabilize
    Serial.println("üî• ALARMCO Initialized...");  //MQ-9 Carbon Monoxide Detector

    pinMode(MQ9_PIN, INPUT);

    // Serial.println("Starting Smoke Detector...");

    pinMode(SMOKE_SENSOR_PIN, INPUT);

    pinMode(LPG_SENSOR, INPUT);

    pinMode(BUZZER_PIN, OUTPUT);
    digitalWrite(BUZZER_PIN,LOW);

}

void loop() {
    int sensorValue = analogRead(MQ9_PIN);
    float voltage = sensorValue * (VOLTAGE_REF / ADC_RESOLUTION);

    // Improved PPM Calculation based on Calibration Factor
    float coPPM = voltage * 50;  // 50 - Assumed Value 

    // Prevent negative values
    if (coPPM < 0) coPPM = 0;

    // Print sensor data
    Serial.print("Sensor Value: ");
    Serial.print(sensorValue);
    Serial.print(" | Voltage: ");
    Serial.print(voltage, 2);
    Serial.print(" V | CO Concentration: ");
    Serial.print(coPPM);
    Serial.println(" PPM");

    // Alert if CO levels exceed threshold
    if (coPPM > PPM_THRESHOLD) {
        Serial.println("‚ö†Ô∏è WARNING: High Carbon Monoxide Level! ‚ö†Ô∏è");
        Serial.println(' ');
        digitalWrite(BUZZER_PIN,HIGH);
        delay(1000);
    } else {
        Serial.println("‚úÖ Safe CO Levels.");
        Serial.println(' ');
        digitalWrite(BUZZER_PIN,LOW);
    }

    //Smoke Detector Code
    int sensor_read = analogRead(SMOKE_SENSOR_PIN); 
    Serial.print("Smoke Density: ");
    Serial.println(sensor_read);

    //if Smoke Density level exceeds threshold
    if (sensor_read > SAFETY_LIMIT) {
        Serial.println("‚ö†Ô∏è WARNING: High Smoke Density! ‚ö†Ô∏è");
        tone(BUZZER_PIN, 500);  // Play a 500 Hz tone
    } else {
        Serial.println("‚úÖ Safe Smoke Density Levels.");
        noTone(BUZZER_PIN);     // Stop the buzzer
    }

    //LPG detector code
    int sensorValueLPG = analogRead(LPG_SENSOR);  // Read LPG sensor value
    if (sensorValue > 1400)  // Adjust the threshold based on testing
    
    // if (sensorValueLPG > (averageLPGValue + 200)) {  // Detects sudden increase
    {
        digitalWrite(BUZZER_PIN, HIGH);
        Serial.println("‚ö†Ô∏è WARNING: LPG GAS LEAKAGE! ‚ö†Ô∏è");
        delay(500);
        digitalWrite(BUZZER_PIN, LOW);
        delay(500);
    }
    else
    {
        digitalWrite(BUZZER_PIN, LOW);
        Serial.println("‚úÖ Safe LPG GAS Levels.");
        delay(1000);}


    delay(3000);  // Wait for 3 seconds before next reading
}






    


